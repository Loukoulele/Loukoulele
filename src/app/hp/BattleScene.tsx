"use client";

import { useEffect, useRef, useCallback } from 'react';
import * as PIXI from 'pixi.js';

// ============ DARK DUNGEON BATTLE SCENE - CASTLEVANIA STYLE ============

// Module-level singleton to prevent multiple PIXI instances
let globalPixiApp: PIXI.Application | null = null;
let globalInitialized = false;

// ===== WIZARD SPRITE (dark mage casting) =====
const WIZARD_SPRITE = {
  palette: [
    '#00000000', '#0a0a12', '#1a1a2e', '#2d2d4a', '#3d3d5c',
    '#4a4a6e', '#d4c4b0', '#b8a898', '#2a2a3a', '#6af', '#4cf'
  ],
  pixels: [
    [0,0,0,0,0,0,0,0,0,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,8,8,7,7,7,7,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,8,7,6,6,6,6,7,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,8,7,6,6,6,6,7,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,7,6,6,6,6,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,7,6,6,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,1,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,4,3,3,2,2,1,0,0,0,0,0,9,10,9,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,3,3,4,4,4,3,3,2,1,0,0,0,9,10,10,10,9,0,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,3,4,4,4,4,4,3,2,2,6,6,9,10,10,9,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,3,3,4,4,5,4,4,3,3,6,6,9,10,9,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,3,4,4,5,5,5,4,4,3,6,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,3,4,4,5,5,5,4,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,3,4,4,4,5,4,4,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,3,3,4,4,4,4,4,3,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,3,3,4,4,4,3,3,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,3,3,3,4,3,3,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,3,3,3,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,2,3,3,3,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,3,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,1,2,2,2,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,1,2,0,0,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,1,2,0,0,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// ===== MONSTER SPRITES (24x24 base, will be scaled up) =====

const LUTIN_SPRITE = {
  palette: ['#00000000','#0d2e0d','#1a4a1a','#2d6a2d','#3d8a3d','#5aaa5a','#7aca7a','#1a1a1a','#ff2222','#ffdd44'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,2,3,3,3,3,3,3,2,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,2,3,3,4,4,4,4,3,3,2,0,0,0,0,0,0],
    [0,0,0,0,0,2,2,2,2,3,4,4,5,5,4,4,3,2,2,2,2,0,0,0],
    [0,0,0,0,2,3,3,3,2,3,4,5,5,5,5,4,3,2,3,3,3,2,0,0],
    [0,0,0,2,3,4,4,3,2,3,4,5,6,6,5,4,3,2,3,4,4,3,2,0],
    [0,0,0,2,3,4,3,2,0,2,3,4,5,5,4,3,2,0,2,3,4,3,2,0],
    [0,0,0,0,2,3,2,0,0,2,3,4,4,4,4,3,2,0,0,2,3,2,0,0],
    [0,0,0,0,0,0,0,0,0,2,7,8,4,4,8,7,2,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,2,8,8,4,4,8,8,2,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,2,3,4,4,4,4,3,2,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,2,3,7,9,9,7,3,2,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,2,3,4,4,3,2,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,2,3,3,3,3,2,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,2,3,3,4,4,3,3,2,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,2,3,3,4,4,4,4,3,3,2,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,2,3,4,4,4,4,4,4,3,2,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,2,3,4,4,5,5,4,4,3,2,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,2,3,3,4,4,4,4,3,3,2,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,2,3,3,4,4,3,3,2,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,2,3,3,2,2,3,3,2,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,2,3,2,0,0,2,3,2,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,1,0,0,1,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,0,0,0],
  ]
};

const ARAIGNEE_SPRITE = {
  palette: ['#00000000','#0a0a0a','#1a1a1a','#2a2a2a','#3a3a3a','#4a2a4a','#6a3a6a','#00ff44'],
  pixels: [
    [0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],
    [0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0],
    [0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0],
    [1,0,0,0,0,0,1,0,0,2,2,2,2,2,2,0,0,1,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,1,2,3,3,3,3,3,3,2,1,0,0,0,0,0,1,0],
    [0,0,1,0,0,0,0,2,3,3,4,4,4,4,3,3,2,0,0,0,0,1,0,0],
    [0,0,0,1,0,0,2,3,7,7,4,5,5,4,4,3,3,2,0,0,1,0,0,0],
    [0,0,0,0,1,0,2,3,7,7,4,5,6,5,4,3,3,2,0,1,0,0,0,0],
    [0,0,0,0,0,1,2,3,3,4,4,5,6,5,4,4,3,2,1,0,0,0,0,0],
    [0,0,0,0,1,0,2,3,3,4,4,5,5,5,4,4,3,2,0,1,0,0,0,0],
    [0,0,0,1,0,0,2,3,3,4,4,4,4,4,4,3,3,2,0,0,1,0,0,0],
    [0,0,1,0,0,0,0,2,3,3,3,4,4,3,3,3,2,0,0,0,0,1,0,0],
    [0,1,0,0,0,0,0,0,2,2,3,3,3,3,2,2,0,0,0,0,0,0,1,0],
    [1,0,0,0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,0,0,1],
    [0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
    [0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],
    [0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],
    [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

const LOUP_SPRITE = {
  palette: ['#00000000','#2a2a2a','#4a4a4a','#6a6a6a','#8a8a8a','#1a1a1a','#ffcc00'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0],
    [0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,0,1,2,2,1,0,0,0],
    [0,0,0,1,2,3,2,1,1,1,1,1,1,1,1,1,1,2,3,2,1,0,0,0],
    [0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0],
    [0,0,0,0,0,1,2,2,3,3,3,3,3,3,3,3,2,2,1,0,0,0,0,0],
    [0,0,0,0,0,1,2,6,2,3,3,3,3,3,3,6,2,2,1,0,0,0,0,0],
    [0,0,0,0,0,1,2,6,2,3,3,3,3,3,3,6,2,2,1,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,2,3,3,3,3,3,3,2,2,2,1,0,0,0,0,0],
    [0,0,0,0,1,2,2,2,2,2,3,3,3,3,2,2,2,2,2,1,0,0,0,0],
    [0,0,0,1,2,2,2,2,5,2,2,3,3,2,2,2,2,2,2,2,1,0,0,0],
    [0,0,0,1,2,2,2,5,5,5,2,2,2,2,2,2,2,2,2,2,1,0,0,0],
    [0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0],
    [0,0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0],
    [0,0,0,0,0,1,2,1,0,0,0,0,0,0,0,0,1,2,1,0,0,0,0,0],
    [0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

const TROLL_SPRITE = {
  palette: ['#00000000','#2a4a2a','#3a6a3a','#4a8a4a','#1a1a1a','#8b4513','#ff4444'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,6,3,3,6,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,4,4,4,4,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,5,5,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,0,5,5,5,5,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,3,3,3,3,2,2,1,5,5,5,0,0,0],
    [0,0,0,0,0,0,1,2,3,3,3,3,3,3,3,3,2,5,5,5,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,3,3,3,3,2,2,5,5,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,5,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,1,1,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,1,0,0,1,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

const STRANGULOT_SPRITE = {
  palette: ['#00000000','#1a4a6a','#2a6a8a','#3a8aaa','#4aaacc','#22ff66'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,5,3,3,3,3,5,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,5,3,3,3,3,5,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,1,2,1,2,2,1,2,1,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,1,0,1,0,1,1,0,1,0,1,2,1,0,0,0,0,0],
    [0,0,0,0,1,2,1,0,0,0,1,0,0,1,0,0,0,1,2,1,0,0,0,0],
    [0,0,0,1,2,1,0,0,0,0,0,1,1,0,0,0,0,0,1,2,1,0,0,0],
    [0,0,1,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,1,0,0],
    [0,1,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,1,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

const SPECTRE_SPRITE = {
  palette: ['#00000000','#aaaacc','#8888aa','#666688','#1a1a3a'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,1,2,2,2,2,1,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,1,2,4,2,2,4,2,1,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,4,2,2,4,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,3,3,2,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,3,2,2,3,3,2,2,3,2,2,1,0,0,0,0,0],
    [0,0,0,0,0,1,2,3,0,2,3,0,0,3,2,0,3,2,1,0,0,0,0,0],
    [0,0,0,0,0,0,3,0,0,3,0,0,0,0,3,0,0,3,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

const SQUELETTE_SPRITE = {
  palette: ['#00000000','#ddddcc','#bbbbaa','#999988','#1a1a1a'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,1,4,1,1,4,1,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,1,4,1,1,4,1,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,1,1,4,4,1,1,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,4,4,4,4,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,1,0,1,1,1,1,0,1,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,0,0,0,1,1,1,1,0,0,0,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

const VAMPIRE_SPRITE = {
  palette: ['#00000000','#1a1a1a','#2a2a2a','#e8dcd0','#c4b8a8','#ff0000','#880000'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,4,4,4,4,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,4,3,3,3,3,4,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,4,5,3,3,5,4,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,4,3,3,3,3,4,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,4,3,6,6,3,4,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,4,4,4,4,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,1,1,1,1,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,2,1,1,1,1,2,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,2,2,1,1,1,1,2,2,2,2,1,0,0,0,0,0],
    [0,0,0,0,1,2,2,2,2,2,1,1,1,1,2,2,2,2,2,1,0,0,0,0],
    [0,0,0,0,1,2,2,2,2,2,1,1,1,1,2,2,2,2,2,1,0,0,0,0],
    [0,0,0,0,0,1,2,2,2,2,1,1,1,1,2,2,2,2,1,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,1,1,0,0,1,1,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

const GARDIEN_SPRITE = {
  palette: ['#00000000','#3a3a3a','#5a5a5a','#7a7a7a','#9a9a9a','#44aaff'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,5,3,3,3,3,5,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,5,3,3,3,3,5,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,3,3,3,3,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,3,3,3,4,4,3,3,3,2,2,1,0,0,0,0,0],
    [0,0,0,0,0,1,2,3,3,3,4,4,4,4,3,3,3,2,1,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,3,3,3,4,4,3,3,3,2,2,1,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,3,3,3,3,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,1,0,0,1,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,1,0,0,0,0,1,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

const DRAGON_SPRITE = {
  palette: ['#00000000','#2a1a1a','#5a2a2a','#8a3a3a','#aa5a5a','#ffaa00','#ffdd44'],
  pixels: [
    [0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,1,0,0,1,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,3,2,1,1,2,3,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,3,3,3,3,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,5,3,3,5,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,5,3,3,5,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,5,6,5,0,1,2,3,3,5,6,3,3,2,1,0,0,0,0,0,0,0],
    [0,0,5,6,5,6,5,1,2,3,3,3,3,3,3,2,1,0,0,0,0,0,0,0],
    [0,0,0,5,6,5,0,1,2,2,3,3,3,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,1,0,0,1,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

const DEMON_SPRITE = {
  palette: ['#00000000','#4a0a0a','#8a1a1a','#aa3a3a','#ffaa00','#1a1a1a'],
  pixels: [
    [0,0,0,0,0,5,5,0,0,0,0,0,0,0,0,5,5,0,0,0,0,0,0,0],
    [0,0,0,0,5,5,5,5,0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0],
    [0,0,0,0,0,5,5,5,1,1,1,1,1,1,5,5,5,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,4,2,2,4,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,4,2,2,4,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,5,5,2,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,5,5,0,1,2,2,3,3,3,3,2,2,1,0,5,5,0,0,0,0,0],
    [0,0,5,5,5,5,1,2,3,3,3,3,3,3,2,1,5,5,5,5,0,0,0,0],
    [0,0,0,5,5,0,1,2,2,3,3,3,3,2,2,1,0,5,5,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,1,1,2,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

const FAUCHEUR_SPRITE = {
  palette: ['#00000000','#0a0a0a','#1a1a1a','#2a2a2a','#888888','#aaaaaa'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,4,4,4,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,4,5,5,5,4,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,4,5,4,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,1,2,2,1,2,1,0,0,0,4,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,4,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,4,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,4,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,4,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,4,4,4,4,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,1,1,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Zone 5: Goule (zombie vert décomposé)
const GOULE_SPRITE = {
  palette: ['#00000000','#1a3a1a','#2a5a2a','#3a7a3a','#4a9a4a','#1a1a1a','#882222'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,6,3,3,6,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,6,3,3,6,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,5,5,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,0,2,3,3,3,3,3,3,2,0,1,0,0,0,0,0,0],
    [0,0,0,0,0,1,0,0,2,2,3,3,3,3,2,2,0,0,1,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,1,1,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Zone 10: Golem de Pierre (statue massive)
const GOLEM_SPRITE = {
  palette: ['#00000000','#3a3a3a','#5a5a5a','#7a7a7a','#9a9a9a','#2a2a2a','#ffaa00'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,6,3,3,3,3,6,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,6,3,3,3,3,6,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,5,5,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,3,3,3,3,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,3,3,3,4,4,3,3,3,2,2,1,0,0,0,0,0],
    [0,0,0,0,1,2,2,3,3,3,4,4,4,4,3,3,3,2,2,1,0,0,0,0],
    [0,0,0,0,1,2,2,3,3,3,3,4,4,3,3,3,3,2,2,1,0,0,0,0],
    [0,0,0,0,0,1,2,2,3,3,3,3,3,3,3,3,2,2,1,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,1,0,0,0,0,1,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,1,0,0,0,0,0,0,1,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Zone 11: Salamandre (lézard de feu)
const SALAMANDRE_SPRITE = {
  palette: ['#00000000','#aa2200','#dd4400','#ff6600','#ff9900','#ffcc00','#1a1a1a'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,5,5,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,5,4,4,5,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,6,6,2,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,3,3,4,4,3,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,3,3,3,3,3,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,2,3,3,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,1,2,2,2,2,1,1,0,0,0,1,1,1,0,0,0],
    [0,0,0,0,0,0,0,1,0,1,0,0,1,0,1,0,0,1,2,2,1,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,2,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Zone 13: Géant de Glace
const GEANT_SPRITE = {
  palette: ['#00000000','#4a6a8a','#6a8aaa','#8aaacc','#aaccee','#2244ff','#1a1a3a'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,5,3,3,5,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,5,3,3,5,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,6,6,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,4,4,3,3,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,3,3,4,4,4,4,3,3,2,2,1,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,3,3,3,4,4,3,3,3,2,2,1,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,3,3,3,3,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,1,0,0,1,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,1,0,0,0,0,1,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Zone 14: Djinn (esprit du vent)
const DJINN_SPRITE = {
  palette: ['#00000000','#2a4a6a','#4a7aaa','#6aaadd','#aaddff','#ffffff','#ffcc00'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,4,3,3,4,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,6,3,3,6,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,4,1,2,2,3,3,3,3,2,2,1,4,0,0,0,0,0,0],
    [0,0,0,0,0,4,3,2,2,3,3,3,3,3,3,2,2,3,4,0,0,0,0,0],
    [0,0,0,0,0,0,4,1,2,2,3,3,3,3,2,2,1,4,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Zone 15: Chevalier Noir
const CHEVALIER_SPRITE = {
  palette: ['#00000000','#1a1a1a','#2a2a2a','#3a3a3a','#4a4a4a','#aa0000','#666666'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,5,3,3,5,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,4,4,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,6,6,6,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,0,6,6,6,0,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,4,4,3,3,2,2,1,6,6,0,0,0,0],
    [0,0,0,0,0,0,1,2,3,3,4,4,4,4,3,3,6,6,6,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,4,4,3,3,6,6,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,6,6,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,1,1,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,1,0,0,1,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Zone 16: Liche (mage mort-vivant avec couronne)
const LICHE_SPRITE = {
  palette: ['#00000000','#1a1a2a','#2a2a4a','#3a3a6a','#6666aa','#44ff88','#ffdd00'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,6,0,6,6,0,6,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,5,3,3,5,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,5,3,3,5,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,1,1,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,5,2,2,3,3,4,4,3,3,2,2,5,0,0,0,0,0,0],
    [0,0,0,0,0,5,0,1,2,2,3,4,4,3,2,2,1,0,5,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,1,1,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Zone 17: Nécromant (mage sombre avec bâton)
const NECROMANT_SPRITE = {
  palette: ['#00000000','#0a0a1a','#1a1a3a','#2a2a5a','#4a4a8a','#aa44ff','#44ff44'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,5,5,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,5,6,5,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,5,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,5,3,3,5,2,1,0,0,0,0,5,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,5,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,1,1,2,2,1,0,0,0,0,5,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,5,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,5,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,5,5,5,5,0,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,4,4,3,3,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,3,3,4,4,4,4,3,3,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,4,4,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,1,1,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Zone 19: Archange Déchu (ailes brisées)
const ARCHANGE_SPRITE = {
  palette: ['#00000000','#2a2a3a','#4a4a5a','#6a6a7a','#8a8aaa','#ffdd00','#ff4444'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,6,3,3,6,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,1,1,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,1,1,0,0,0,1,2,2,3,3,3,3,2,2,1,0,0,0,1,1,0,0],
    [0,1,2,2,1,0,1,2,2,3,3,4,4,3,3,2,2,1,0,1,2,2,1,0],
    [0,0,1,2,2,1,1,2,3,3,4,4,4,4,3,3,2,1,1,2,2,1,0,0],
    [0,0,0,1,2,1,0,1,2,2,3,4,4,3,2,2,1,0,1,2,1,0,0,0],
    [0,0,0,0,1,0,0,0,1,2,2,3,3,2,2,1,0,0,0,1,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,1,1,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Zone 20: Entité Alpha (créature cosmique)
const ENTITE_SPRITE = {
  palette: ['#00000000','#1a1a3a','#3a3a6a','#6a4aaa','#aa6aee','#ffffff','#ff44ff'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,4,3,3,4,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,5,3,3,5,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,5,3,3,5,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,4,0,0,1,2,2,3,3,2,2,1,0,0,4,0,0,0,0,0],
    [0,0,0,0,4,3,4,1,2,2,3,4,4,3,2,2,1,4,3,4,0,0,0,0],
    [0,0,0,0,0,4,0,1,2,3,4,4,4,4,3,2,1,0,4,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,3,4,4,3,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,3,3,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Zone 21: Chrono-Bête (créature temporelle avec sablier)
const CHRONO_SPRITE = {
  palette: ['#00000000','#3a3a2a','#6a6a4a','#9a9a6a','#cccc8a','#ffdd00','#44aaff'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,5,4,4,4,4,5,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,5,4,4,5,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,5,5,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,5,4,4,5,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,5,4,4,4,4,5,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,6,3,3,6,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,3,3,2,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,1,1,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Zone 22: Vide Incarné (trou noir)
const VIDE_SPRITE = {
  palette: ['#00000000','#0a0a0a','#1a1a2a','#2a2a4a','#4a3a6a','#6a4a8a','#aa66cc'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,5,4,4,4,4,5,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,5,4,3,3,3,3,4,5,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,5,4,3,2,2,2,2,3,4,5,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,5,4,3,2,1,1,2,3,4,5,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,5,4,3,2,1,1,2,3,4,5,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,5,4,3,2,1,1,2,3,4,5,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,5,4,3,2,1,1,2,3,4,5,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,5,4,3,2,2,2,2,3,4,5,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,5,4,3,3,3,3,4,5,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,5,4,4,4,4,5,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,5,5,5,5,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Zone 23: Titan du Chaos (géant de feu et ténèbres)
const TITAN_SPRITE = {
  palette: ['#00000000','#2a1a1a','#5a2a2a','#8a3a3a','#cc5a5a','#ff8844','#ffcc00'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,6,0,0,0,0,6,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,5,3,3,5,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,5,3,3,5,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,6,6,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,3,3,3,3,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,4,4,3,3,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,3,3,4,5,5,4,3,3,2,2,1,0,0,0,0,0],
    [0,0,0,0,0,1,2,2,3,3,4,5,5,4,3,3,2,2,1,0,0,0,0,0],
    [0,0,0,0,0,0,1,2,2,3,3,4,4,3,3,2,2,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,2,3,3,2,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,2,1,0,0,1,2,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,1,2,1,0,0,0,0,1,2,1,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Zone 24: L'Éternel (être de lumière pure)
const ETERNEL_SPRITE = {
  palette: ['#00000000','#6a6a8a','#8a8aaa','#aaaacc','#ccccee','#ffffff','#ffdd44'],
  pixels: [
    [0,0,0,0,0,0,0,0,0,0,6,6,6,6,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,6,5,5,5,5,6,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,6,6,6,6,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,5,3,3,5,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,1,2,2,3,3,2,2,1,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,5,5,0,0,0,1,2,2,3,3,2,2,1,0,0,0,5,5,0,0,0],
    [0,0,5,4,4,5,0,1,2,2,3,4,4,3,2,2,1,0,5,4,4,5,0,0],
    [0,0,5,4,3,4,5,1,2,3,4,5,5,4,3,2,1,5,4,3,4,5,0,0],
    [0,0,0,5,4,5,0,1,2,2,3,4,4,3,2,2,1,0,5,4,5,0,0,0],
    [0,0,0,0,5,0,0,0,1,2,2,3,3,2,2,1,0,0,0,5,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,2,1,1,2,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ]
};

// Monster sprites mapping by zone - ALL 25 UNIQUE
const MOB_SPRITES: { [key: number]: typeof LUTIN_SPRITE } = {
  0: LUTIN_SPRITE,
  1: ARAIGNEE_SPRITE,
  2: LOUP_SPRITE,
  3: TROLL_SPRITE,
  4: STRANGULOT_SPRITE,
  5: GOULE_SPRITE,
  6: SPECTRE_SPRITE,
  7: SQUELETTE_SPRITE,
  8: VAMPIRE_SPRITE,
  9: GARDIEN_SPRITE,
  10: GOLEM_SPRITE,
  11: SALAMANDRE_SPRITE,
  12: DRAGON_SPRITE,
  13: GEANT_SPRITE,
  14: DJINN_SPRITE,
  15: CHEVALIER_SPRITE,
  16: LICHE_SPRITE,
  17: NECROMANT_SPRITE,
  18: DEMON_SPRITE,
  19: ARCHANGE_SPRITE,
  20: ENTITE_SPRITE,
  21: CHRONO_SPRITE,
  22: VIDE_SPRITE,
  23: TITAN_SPRITE,
  24: ETERNEL_SPRITE,
};

// Create texture from pixel array
function createSpriteTexture(
  spriteData: { palette: string[]; pixels: number[][] },
  app: PIXI.Application,
  scale: number = 4
): PIXI.Texture {
  const pixels = spriteData.pixels;
  const palette = spriteData.palette;
  const height = pixels.length;
  const width = pixels[0].length;
  const graphics = new PIXI.Graphics();

  for (let y = 0; y < height; y++) {
    for (let x = 0; x < width; x++) {
      const colorIdx = pixels[y][x];
      if (colorIdx > 0) {
        const color = palette[colorIdx];
        graphics.rect(x * scale, y * scale, scale, scale);
        graphics.fill(color);
      }
    }
  }

  return app.renderer.generateTexture(graphics);
}

// Draw dungeon background
function drawDungeonBackground(app: PIXI.Application): PIXI.Container {
  const bg = new PIXI.Container();

  // Base dark background
  const baseBg = new PIXI.Graphics();
  baseBg.rect(0, 0, 500, 300);
  baseBg.fill(0x0a0a12);
  bg.addChild(baseBg);

  // Back wall with stone pattern
  const wall = new PIXI.Graphics();
  const stoneColors = [0x1a1a24, 0x22222e, 0x181820, 0x202030];

  for (let row = 0; row < 4; row++) {
    for (let col = 0; col < 12; col++) {
      const x = col * 45 + (row % 2) * 22;
      const y = row * 35;
      const w = 42;
      const h = 32;
      const color = stoneColors[(row + col) % stoneColors.length];

      wall.rect(x, y, w, h);
      wall.fill(color);
      wall.rect(x, y, w, 2);
      wall.fill(0x0a0a10);
      wall.rect(x, y, 2, h);
      wall.fill(0x0a0a10);
      wall.rect(x + 2, y + h - 2, w - 2, 2);
      wall.fill(0x2a2a3a);
    }
  }
  bg.addChild(wall);

  // Mysterious eye/portal
  const eyeX = 250, eyeY = 70;
  const eyeGlow = new PIXI.Graphics();
  eyeGlow.circle(eyeX, eyeY, 35);
  eyeGlow.fill({ color: 0x4a2a6a, alpha: 0.3 });
  bg.addChild(eyeGlow);

  const eyeSocket = new PIXI.Graphics();
  eyeSocket.ellipse(eyeX, eyeY, 30, 20);
  eyeSocket.fill(0x1a0a2a);
  bg.addChild(eyeSocket);

  const eyePupil = new PIXI.Graphics();
  eyePupil.circle(eyeX, eyeY, 8);
  eyePupil.fill(0x8844aa);
  bg.addChild(eyePupil);

  // Floor - cobblestones
  const floor = new PIXI.Graphics();
  const floorY = 140;
  floor.rect(0, floorY, 500, 160);
  floor.fill(0x2a2a3a);

  for (let row = 0; row < 8; row++) {
    const yPos = floorY + row * 22;
    const stoneHeight = 18 + row;
    const stoneWidth = 35 + row * 5;
    for (let col = 0; col < 15; col++) {
      const xOffset = (row % 2) * (stoneWidth / 2);
      const x = col * stoneWidth - xOffset;
      const color = (row + col) % 3 === 0 ? 0x3a3a4a : 0x32323e;
      floor.rect(x + 2, yPos + 2, stoneWidth - 4, stoneHeight - 4);
      floor.fill(color);
    }
  }
  bg.addChild(floor);

  return bg;
}

interface BattleSceneProps {
  onReady?: (api: BattleAPI) => void;
  currentZone?: number;
}

export interface BattleAPI {
  castSpell: (spellType?: string) => void;
  hitMob: () => void;
  updateMobHp: (percent: number) => void;
  setMobName: (name: string) => void;
  setZone: (zone: number) => void;
}

export default function BattleScene({ onReady, currentZone = 0 }: BattleSceneProps) {
  const containerRef = useRef<HTMLDivElement>(null);
  const appRef = useRef<PIXI.Application | null>(null);
  const mobRef = useRef<PIXI.Sprite | null>(null);
  const wizardRef = useRef<PIXI.Sprite | null>(null);
  const particlesRef = useRef<PIXI.Container | null>(null);
  const currentZoneRef = useRef<number>(currentZone);

  const castSpell = useCallback((spellType: string = 'ice') => {
    const app = appRef.current;
    const particles = particlesRef.current;
    const wizard = wizardRef.current;
    if (!app || !particles || !wizard) return;

    const wizardBaseX = 80, wizardBaseY = 260;
    const mobBaseX = 380, mobBaseY = 220;

    wizard.x = wizardBaseX + 5;
    setTimeout(() => { wizard.x = wizardBaseX; }, 150);

    const colors = spellType === 'fire' ? [0xff4400, 0xff8800, 0xffcc00] :
                   spellType === 'dark' ? [0x6622aa, 0x8844cc, 0xaa66ee] :
                   [0x2288ff, 0x44aaff, 0xaaddff];

    const spell = new PIXI.Graphics();
    spell.circle(0, 0, 12);
    spell.fill({ color: colors[2], alpha: 0.9 });
    spell.circle(0, 0, 8);
    spell.fill({ color: colors[1], alpha: 0.8 });
    spell.circle(0, 0, 4);
    spell.fill({ color: 0xffffff, alpha: 1 });

    spell.x = wizardBaseX + 60;
    spell.y = wizardBaseY - 50;
    particles.addChild(spell);

    const startX = spell.x, startY = spell.y;
    const endX = mobBaseX - 20, endY = mobBaseY - 30;
    const duration = 200;
    const startTime = Date.now();

    const animateSpell = () => {
      const elapsed = Date.now() - startTime;
      const progress = Math.min(elapsed / duration, 1);
      spell.x = startX + (endX - startX) * progress;
      spell.y = startY + (endY - startY) * progress;

      if (Math.random() > 0.6) {
        const trail = new PIXI.Graphics();
        trail.circle(0, 0, 3);
        trail.fill({ color: colors[1], alpha: 0.5 });
        trail.x = spell.x;
        trail.y = spell.y;
        particles.addChild(trail);
        const fade = () => { trail.alpha -= 0.1; if (trail.alpha > 0) requestAnimationFrame(fade); else particles.removeChild(trail); };
        fade();
      }

      if (progress < 1) requestAnimationFrame(animateSpell);
      else {
        particles.removeChild(spell);
        for (let i = 0; i < 10; i++) {
          const p = new PIXI.Graphics();
          p.circle(0, 0, 3);
          p.fill({ color: colors[Math.floor(Math.random() * 3)], alpha: 0.8 });
          p.x = endX; p.y = endY;
          particles.addChild(p);
          const angle = Math.random() * Math.PI * 2;
          const speed = 3 + Math.random() * 4;
          const vx = Math.cos(angle) * speed, vy = Math.sin(angle) * speed;
          const anim = () => { p.x += vx; p.y += vy; p.alpha -= 0.05; if (p.alpha > 0) requestAnimationFrame(anim); else particles.removeChild(p); };
          anim();
        }
      }
    };
    animateSpell();
  }, []);

  const hitMob = useCallback(() => {
    const mob = mobRef.current;
    if (!mob) return;
    const baseX = 380;
    mob.tint = 0xff8888;
    mob.x = baseX + 8;
    setTimeout(() => { mob.tint = 0xffffff; mob.x = baseX - 4; }, 50);
    setTimeout(() => { mob.tint = 0xffffff; mob.x = baseX; }, 100);
  }, []);

  const updateMobHp = useCallback(() => {}, []);
  const setMobName = useCallback(() => {}, []);

  const setZone = useCallback((zone: number) => {
    const app = appRef.current;
    const mob = mobRef.current;
    if (!app || !mob) return;
    if (currentZoneRef.current === zone) return;
    currentZoneRef.current = zone;

    const mobSpriteData = MOB_SPRITES[zone] || LUTIN_SPRITE;
    const newTexture = createSpriteTexture(mobSpriteData, app, 4);
    mob.texture = newTexture;
  }, []);

  useEffect(() => {
    if (!containerRef.current) return;
    if (globalInitialized) {
      if (globalPixiApp && containerRef.current.children.length === 0) {
        containerRef.current.appendChild(globalPixiApp.canvas);
        appRef.current = globalPixiApp;
      }
      return;
    }
    globalInitialized = true;

    const initPixi = async () => {
      if (containerRef.current) containerRef.current.innerHTML = '';

      const app = new PIXI.Application();
      await app.init({ width: 500, height: 300, backgroundColor: 0x0a0a12, antialias: false, resolution: window.devicePixelRatio || 1, autoDensity: true });

      globalPixiApp = app;
      containerRef.current!.appendChild(app.canvas);
      appRef.current = app;

      const background = drawDungeonBackground(app);
      app.stage.addChild(background);

      const wizardTexture = createSpriteTexture(WIZARD_SPRITE, app, 3);
      const wizard = new PIXI.Sprite(wizardTexture);
      wizard.anchor.set(0.5, 1);
      wizard.x = 80; wizard.y = 260;
      app.stage.addChild(wizard);
      wizardRef.current = wizard;

      let wizardTime = 0;
      app.ticker.add((t) => { wizardTime += t.deltaTime * 0.03; wizard.y = 260 + Math.sin(wizardTime) * 2; });

      const particles = new PIXI.Container();
      app.stage.addChild(particles);
      particlesRef.current = particles;

      const mobSpriteData = MOB_SPRITES[currentZone] || LUTIN_SPRITE;
      const mobTexture = createSpriteTexture(mobSpriteData, app, 4);
      const mob = new PIXI.Sprite(mobTexture);
      mob.anchor.set(0.5, 1);
      mob.x = 380; mob.y = 270;
      mob.scale.x = -1;
      app.stage.addChild(mob);
      mobRef.current = mob;

      let mobTime = 0;
      app.ticker.add((t) => { mobTime += t.deltaTime * 0.05; mob.y = 270 + Math.sin(mobTime) * 3; });

      if (onReady) onReady({ castSpell, hitMob, updateMobHp, setMobName, setZone });
    };

    initPixi();

    return () => { if (containerRef.current) containerRef.current.innerHTML = ''; appRef.current = null; };
  }, [castSpell, hitMob, updateMobHp, setMobName, setZone, onReady, currentZone]);

  return (
    <div ref={containerRef} style={{ width: '100%', maxWidth: '500px', margin: '0 auto', borderRadius: '4px', overflow: 'hidden', border: '3px solid #1a1a2e', boxShadow: '0 0 20px rgba(0,0,0,0.8)', imageRendering: 'pixelated' }} />
  );
}
